stages:
  - build
  - test

variables:
  NODE_ENV: development

# Build client
build-client-job:
  stage: build
  image: node:18
  script:
    - cd geolocation
    - npm ci
    - npm run build
  artifacts:
    paths:
      - geolocation/dist
    expire_in: 1 hour  # Optional: how long to keep artifacts

# Build server
build-server-job:
  stage: build
  image: node:18
  script:
    - cd server
    - npm ci
  artifacts:
    paths:
      - server
    expire_in: 1 hour

# Test client using artifacts
unit-test-client-job:
  stage: test
  image: node:18
  needs:
    - job: build-client-job
      artifacts: true
  script:
    - cd geolocation
    - npm ci
    - npm run test

# # Test server using artifacts
# unit-test-server-job:
#   stage: test
#   image: node:18
#   needs:
#     - job: build-server-job
#       artifacts: true
#   script:
#     - cd server
#     - npm ci
#     - npm run test